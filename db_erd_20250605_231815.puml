@startuml
!theme plain
skinparam backgroundColor #FAFAFA
skinparam classAttributeIconSize 0
skinparam classFontSize 14

entity taxonomy_granular {
  * **id** : INTEGER
  --
  # chunk_te_id : INTEGER <<NOT NULL>>
  text_span : TEXT <<NOT NULL>>
  justification : TEXT <<NOT NULL>>
  embedding : NULL <<NULL>>
  --
  Rows: 686,259
}

entity taxonomy_summary {
  * **id** : INTEGER
  --
  period : VARCHAR(7) <<NOT NULL>>
  taxonomy_level : INTEGER <<NOT NULL>>
  taxon : VARCHAR <<NOT NULL>>
  database : VARCHAR <<NULL>>
  summary_text : TEXT <<NOT NULL>>
  chunk_count : INTEGER <<NOT NULL>>
  document_count : INTEGER <<NOT NULL>>
  created_at : TIMESTAMP <<NOT NULL>>
  --
  Rows: 246
}

entity alembic_version {
  * **version_num** : VARCHAR(32)
  --
  --
  Rows: 1
}

entity summary_comparison {
  * **id** : INTEGER
  --
  taxon : VARCHAR <<NOT NULL>>
  database : VARCHAR <<NULL>>
  current_period : VARCHAR(7) <<NOT NULL>>
  previous_period : VARCHAR(7) <<NOT NULL>>
  comparison_text : TEXT <<NOT NULL>>
  created_at : TIMESTAMP <<NOT NULL>>
  --
  Rows: 4
}

entity taxonomy {
  * **id** : INTEGER
  --
  # classification_id : INTEGER <<NOT NULL>>
  # chunk_id : INTEGER <<NOT NULL>>
  category : VARCHAR <<NOT NULL>>
  subcategory : VARCHAR <<NOT NULL>>
  sub_subcategory : VARCHAR <<NOT NULL>>
  taxonomy_reasoning : TEXT <<NOT NULL>>
  chunk_level_reasoning : TEXT <<NOT NULL>>
  --
  Rows: 224,668
}

entity document_section {
  * **id** : INTEGER
  --
  # uploaded_document_id : INTEGER <<NOT NULL>>
  # parent_document_section_id : INTEGER <<NULL>>
  heading_title : TEXT <<NOT NULL>>
  heading_depth : INTEGER <<NOT NULL>>
  content : TEXT <<NULL>>
  sequence_number : INTEGER <<NOT NULL>>
  path : NULL <<NOT NULL>>
  --
  Rows: 534,708
}

entity document_section_chunk {
  * **id** : INTEGER
  --
  # document_section_id : INTEGER <<NOT NULL>>
  chunk_index : INTEGER <<NOT NULL>>
  content : TEXT <<NOT NULL>>
  embedding : NULL <<NULL>>
  embedding_model : TEXT <<NULL>>
  keywords : ARRAY <<NULL>>
  content_lemmatized : ARRAY <<NULL>>
  named_entities : JSONB <<NULL>>
  keywords_llm : JSONB <<NULL>>
  --
  Rows: 484,659
}

entity classifications {
  * **id** : INTEGER
  --
  # chunk_id : INTEGER <<NOT NULL>>
  chat_id : VARCHAR <<NOT NULL>>
  model : VARCHAR <<NOT NULL>>
  created_at : TIMESTAMP <<NOT NULL>>
  done_reason : VARCHAR <<NOT NULL>>
  total_duration : BIGINT <<NOT NULL>>
  usage_prompt_tokens : INTEGER <<NOT NULL>>
  usage_completion_tokens : INTEGER <<NOT NULL>>
  usage_tokens : INTEGER <<NOT NULL>>
  request : TEXT <<NOT NULL>>
  raw_response : TEXT <<NULL>>
  response : TEXT <<NULL>>
  --
  Rows: 166,823
}

entity uploaded_document {
  * **id** : INTEGER
  --
  document_id : VARCHAR <<NOT NULL>>
  database : VARCHAR <<NOT NULL>>
  date : DATE <<NULL>>
  author : VARCHAR <<NULL>>
  language : VARCHAR <<NULL>>
  is_full_text_present : BOOLEAN <<NOT NULL>>
  text : TEXT <<NULL>>
  text_en : TEXT <<NULL>>
  source : VARCHAR <<NULL>>
  --
  Rows: 322,479
}

entity logs {
  * **id** : INTEGER
  --
  document_id : TEXT <<NULL>>
  database : VARCHAR <<NULL>>
  stage : VARCHAR <<NULL>>
  model : VARCHAR <<NULL>>
  created_at : TIMESTAMP <<NULL>>
  done : BOOLEAN <<NULL>>
  done_reason : VARCHAR <<NULL>>
  total_duration : BIGINT <<NULL>>
  load_duration : BIGINT <<NULL>>
  prompt_eval_count : INTEGER <<NULL>>
  prompt_eval_duration : BIGINT <<NULL>>
  eval_count : INTEGER <<NULL>>
  eval_duration : BIGINT <<NULL>>
  raw_response : TEXT <<NULL>>
  response : TEXT <<NULL>>
  --
  Rows: 558,005
}

entity taxonomy_clusters_kmeans {
  * **id** : INTEGER
  --
  taxonomic_element : VARCHAR <<NOT NULL>>
  cluster_id : VARCHAR <<NOT NULL>>
  cluster_label : VARCHAR <<NULL>>
  span_ids : ARRAY <<NOT NULL>>
  summary : JSON <<NULL>>
  --
  Rows: 309
}

taxonomy_granular }o--|| taxonomy : chunk_te_id
taxonomy }o--|| document_section_chunk : chunk_id
taxonomy }o--|| classifications : classification_id
document_section }o--|| document_section : parent_document_section_id
document_section }o--|| uploaded_document : uploaded_document_id
document_section_chunk }o--|| document_section : document_section_id
classifications }o--|| document_section_chunk : chunk_id

@enduml